
# Apache Airflow Command Injection in Example Dag (CVE-2020-11978)

Directed Acyclic Graph (DAG) is a core concept of airflow that performs task collection, i.e. collection of all the tasks you want to run, organized in a way that reflects their relationships and dependencies. A DAG is implemented in a Python script and it represents the DAGs structure (tasks and their dependencies) as code. However, a remote code/command injection vulnerability was discovered in one of the example DAGs shipped with Airflow which would allow any authenticated user to run arbitrary commands as the user running airflow worker/scheduler.

# Activating Vulnerable Environment
< br/>
Run the following commands to activate vulnerable airflow 1.10.10:
< br/>
< br/>
#Initialize the database
< br/>
docker-compose run airflow-init
< br/>
< br/>
#Start the docker-compose service
< br/>
docker-compose up -d
< br/>

#Activating Vulnerable Environment
< br/>
Run the following commands to activate vulnerable airflow 1.10.10:
< br/>
< br/>
#Initialize the database
< br/>
docker-compose run airflow-init
< br/>
< br/>
#Start the docker-compose service
< br/>
docker-compose up -d
< br/>

# Exploitation
< br/>
To see the airflow management terminal
< br/>
      â€¢	check http://your-ip-addres:8080
< br/>
< br/>
Look for 'example_trigger_target_dag'  (It appears at the end) 
< br/>
< br/>
Turn on the DAG (example_trigger_target_dag) 
< br/>
(toggle over the symbols on the right end column to identify the start button and press that to trigger)
< br/>
< br/>
When the trigger window that ask for JSON configuration appears:
< br/>
  â€¢ Use the crafted malicious payload as input:
    < br/>
    {"message":"'\";touch /tmp/airflow_dag_success;#"}
    < br/>
  â€¢ Press Trigger
  < br/>
  < br/>
Wait for some time (if you didnâ€™t see any change, please refresh the page to see the successful execution).
< br/>
< br/>
To see the result of exploitation, letâ€™s check the CeleryWorker container by executing the bash file:
< br/>
â€¢	Sudo bash test_exploit.sh
< br/>
< br/>
If you are able to succesfully execute the exploit, then youâ€™ll find your flag ðŸ˜Š
< br/>
< br/>
# References
< br/>
https://www.exploit-db.com/exploits/49927
< br/>
https://nvd.nist.gov/vuln/detail/CVE-2020-11978
< br/>
https://www.cvedetails.com/cve/CVE-2020-11978/
< br/>
https://www.fortiguard.com/encyclopedia/ips/51714
< br/>
https://support.ixiacom.com/strikes/exploits/apache/cve_2020_11978_apache_airflow_command_injection.xml
